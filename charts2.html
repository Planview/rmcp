<!DOCTYPE html>
<html>
<head>
	<title>RMCP Charts</title>
	<link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/css/bootstrap.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js" type="text/javascript"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js"></script>
	<style type="text/css" media="screen">
		#bar-chart {overflow-x: auto;}
	</style>
</head>
<body>
<div class="container">
<header id="header" class="page-header">
	<h1>Capacity Planning Pain Points</h1>
</header><!-- /header -->
<div class="row">
<main class="col-sm-10">
	<div id="bar-chart"></div>
</main>
<footer class="col-sm-2" style="padding-top: 100px">
	<div class="btn-group-vertical" data-toggle="buttons">
	  <label class="total-data btn btn-primary active">
	    <input type="radio" name="options" id="option1" checked> Overall Data
	  </label>
	  <label class="maturity-data btn btn-primary">
	    <input type="radio" name="options" id="option2"> Maturity Data
	  </label>
	  <label class="services-data btn btn-primary">
	    <input type="radio" name="options" id="option3"> Services Data
	  </label>
	  <label class="pd-data btn btn-primary">
	    <input type="radio" name="options" id="option3"> PD Data
	  </label>
	  <label class="it-data btn btn-primary">
	    <input type="radio" name="options" id="option3"> IT Data
	  </label>
	  <label class="enterprise-data btn btn-primary">
	    <input type="radio" name="options" id="option3"> Enterprise Data
	  </label>
	</div>
</footer>
	
</div>
</div>
<script>
var drawRMCPChart = function (container, data, sample, title, callout) {
	var containerSelector = container,
		dataset = data,
		sampleSize = sample,
		titleText = title;

	var dimensions = {
		height: 500,
		width: 800,
		paddingHorizontal: 10,
		paddingVertical: 10,
		yAxisMinWidth: 300,
		calloutMinWidth: 180,
		yAxisProportion: 0.4,
		calloutProportion: 0.18,
		titleHeight: 54,
		legendHeight: 100,
		calloutPaddingLeft: 70,
		otherInfoHeight: 60,
		spaceBetweenBars: 10,
		minWidth: 650,
		hideCallout: 940,
		showCalloutBox: true,
		innerHeight: function () {
			return this.height - 2 * this.paddingVertical;
		},
		innerWidth: function () {
			return this.width - 2 * this.paddingHorizontal;
		},
		calloutWidth: function () {
			return this.showCalloutBox ? Math.round(
				Math.max(
					this.calloutMinWidth,
					(this.innerWidth() * this.calloutProportion)
				)
			) : 0;
		},
		yAxisWidth: function () {
			return Math.round(
				Math.max(
					this.yAxisMinWidth,
					(this.innerWidth() - this.calloutWidth()) *
						this.yAxisProportion
				)
			);
		},
		dataWidth: function () {
			return this.innerWidth() - this.calloutWidth() - 
				this.yAxisWidth() - this.calloutPaddingLeft;
		},
		yAxisLeft: function () { return this.paddingHorizontal;	},
		yAxisRight: function () {
			return this.yAxisLeft() + this.yAxisWidth();
		},
		dataLeft: function () { return this.yAxisRight(); },
		dataRight: function ()  {
			return this.dataLeft() + this.dataWidth();
		},
		calloutLeft: function () {
			return this.dataRight() + this.calloutPaddingLeft;
		},
		calloutRight: function () {
			return this.width - this.paddingHorizontal;
		},
		calloutCenterHorizontal: function () {
			return Math.round(this.calloutLeft() + this.calloutWidth() / 2);
		},
		centerHorizontal: function () { return Math.round(this.width / 2); },
		titleTop: function () { return this.paddingVertical; },
		titleBottom: function () {
			return this.titleTop() + this.titleHeight;
		},
		titleUnderline: function () {
			return this.titleBottom() + this.paddingVertical * 2;
		},
		legendTop: function () {
			return this.titleUnderline() + this.paddingVertical;
		},
		legendBottom: function () {
			return this.legendTop() + this.legendHeight;
		},
		legendCenterVertical: function () {
			return Math.round((this.legendTop() + this.legendBottom()) / 2);
		},
		otherInfoBottom: function () {
			return this.height - this.paddingVertical;
		},
		otherInfoTop: function () {
			return this.otherInfoBottom() - this.otherInfoHeight;
		},
		dataTop: function () {
			return this.legendBottom() + this.paddingVertical;
		},
		dataBottom: function () { return this.otherInfoTop(); },
		dataHeight: function () { return this.dataBottom() - this.dataTop(); },
		calloutTop: function () { return this.legendTop(); },
		calloutBottom: function () { return this.dataBottom(); },
		calloutHeight: function () {
			return this.calloutBottom() - this.calloutTop();
		},
		legendLeft: function () { return this.yAxisLeft(); },
		legendRight: function () { return this.dataRight(); }
	};
	dimensions.width =
		Math.max($(containerSelector).width(), dimensions.minWidth);
	dimensions.height = Math.max(9 * dimensions.width / 16, 700);
	dimensions.showCalloutBox =
		(typeof callout !== 'undefined') ? callout : true;
	var hexagonPath = "M18.536,12.353L2.378,21.681c-1.234,0.714-2.755," +
		"0.714-3.99,0l-16.157-9.328c-1.235-0.712-1.996-2.03-1.996-3.456" +
		"V-9.759c0-1.425,0.76-2.743,1.996-3.455l16.157-9.329c1.235-0.712," +
		"2.756-0.712,3.99,0l16.158,9.329c1.234,0.712,1.994,2.3,1.994,3.455" +
		"V8.897C20.53,10.323,19.771,11.641,18.536,12.353"
	
	var dataKey = function (d) {
		return d.id;
	}

	var svg = d3.select(containerSelector)
		.append("svg")
		.attr("height", dimensions.height)
		.attr("width", dimensions.width);
	var yScaleOuter	= d3.scale.ordinal()
		.domain(d3.range(dataset.length))
		.rangeRoundBands(
			[dimensions.dataTop(), dimensions.dataBottom()], 0.2, 0.1);
	var yScaleInner = d3.scale.ordinal()
		.domain(d3.range(sampleSize.length))
		.rangeRoundBands([0, yScaleOuter.rangeBand()], 0.2);
	var xScale = d3.scale.linear()
		.domain([0, d3.max(dataset, function (d) {
				return d3.max(d.data, function (d, i) {
					return d / sampleSize[i].quantity;
				});
			})])
		.range(
			[0, dimensions.dataWidth()]);
	var colors = d3.scale.ordinal()
		.domain(d3.range(sampleSize.length))
		.range(['#203368', '#48C6EA', '#1B75BB']);
	var legendSpacing = d3.scale.ordinal()
		.domain(d3.range(sampleSize.length))
		.rangeRoundBands(
			[dimensions.legendLeft(), dimensions.legendRight()], 0.1);

	var percentFormat = d3.format('%');

	var resizeText = function (text, width, max) {
		  text.each(function() {
		    var text = d3.select(this),
		    	current = max;

		    do {
		    	text.style("font-size", current + "px");
		    	current -= 2;
		    } while (text.node().getComputedTextLength() > width);
		  });
	};

	var wrapLines = function (text, width) {
		if (width === 0) return;
		  text.each(function() {
		    var text = d3.select(this),
		        words = text.text().split(/\s+/).reverse(),
		        word,
		        line = [],
		        lineNumber = 0,
		        lineHeight = 1.5, // ems
		        y = text.attr("y"),
		        x = text.attr("x"),
		        dy = parseFloat(text.attr("dy")) || 0,
		        tspan = text.text(null).append("tspan")
		        	.attr("x", x)
		        	.attr("y", y)
		        	.attr("dy", dy + "em");
				
		    while (word = words.pop()) {
		      line.push(word);
		      tspan.text(line.join(" "));
		      if (tspan.node().getComputedTextLength() > width) {
		        line.pop();
		        tspan.text(line.join(" "));
		        line = [word];
		        tspan = text.append("tspan")
		        	.attr("x", x)
		        	.attr("y", y)
		        	.attr("dy", ++lineNumber * lineHeight + dy + "em")
		        	.text(word);
		      }
		    }
		  });
	};

	var reWrapLines = function (text, width) {
		if (width === 0 || (typeof width === "number" && isNaN(width))) return;

		text.each(function () {
			var text = d3.select(this),
				tspans = text.selectAll("tspan"),
				content = '';

				if (tspans.empty()) return;

				tspans.each(function () {
					content += d3.select(this).text() + " "
				});

				text.text(content.substring(0,content.length-1));
		});
		wrapLines(text, width);
	};

	var title = svg.append("g");
	title.append("text")	//	Title Text
		.text(titleText)
		.attr("y", dimensions.titleBottom())
		.attr("x", dimensions.centerHorizontal())
		.style({
			'font-family': "'Roboto Slab', serif",
			'text-anchor': 'middle',
			'fill': '#58585b',
			'font-size': '42px'
		})
		.call(resizeText, dimensions.innerWidth(), 42);
	title.append("path")	//	Underline the title
		.attr("d", function () {
			var path = "";
			path += "M" + dimensions.yAxisLeft() + "," +
				dimensions.titleUnderline();
			path += "L" + dimensions.calloutRight() + "," +
				dimensions.titleUnderline();
			return path;				
		})
		.style({
			'stroke': '#58585b',
			'stroke-width': '2px'
		});

	var legend = svg.append("g");
	legend.selectAll("path").data(sampleSize).enter()
		.append("path")
		.attr("d", hexagonPath)
		.style("fill", function (d, i) {
			return colors(i);
		})
		.style({
			'stroke-width': 0,
			// 'stroke': '#203368'
		})
		.attr('transform', function (d, i) {
			return 'translate(' + (21 * 0.6 + legendSpacing(i)) +
				',' + dimensions.legendCenterVertical() + ')'
				+ 'scale(0.6)';
		});
	legend.selectAll("text.legend").data(sampleSize).enter()
		.append("text")
		.attr("class", "legend")
		.text(function (d, i) {
			return d.title + " (n=" + d.quantity + ")";
		})
		.attr("x", function (d, i) {
			return legendSpacing(i) + 41 * 0.6 + dimensions.paddingHorizontal;
		})
		.attr("y", function () {
			return dimensions.legendCenterVertical();
		})
		.style({
			'fill': '#58585b',
			'font-family': 'Open Sans',
			'font-size': '14px',
			'alignment-baseline': 'middle'
		});

	var yAxisGroup = svg.append("g");
	yAxisGroup.append("path")	//	Y-axis line
		.attr("d", function () {
			var path = "";
			path += "M" + (dimensions.yAxisRight() - 1) + "," +
				dimensions.dataTop();
			path += "L" + (dimensions.yAxisRight() - 1) + "," +
				dimensions.dataBottom();
			return path;
		})
		.style({
			'stroke': '#000',
			'stroke-width': '1px'
		});
	yAxisGroup.selectAll("text")	//	Labels
		.data(dataset, dataKey)
		.enter()
		.append("text")
		.attr("x", function () {
			return dimensions.yAxisRight() - dimensions.paddingHorizontal;
		})
		.attr("y", function (d, i) {
			return yScaleOuter(i) + yScaleOuter.rangeBand() / 3;
		})
		.text(function (d) {
			return d.title;
		})
		.call(wrapLines, 
			(dimensions.yAxisWidth() - dimensions.paddingHorizontal)/1.1)
		.style({
			'text-anchor': 'end',
			'fill': '#58585b',
			'font-family': 'Open Sans',
			'font-size': '14px',
			'alignment-baseline': 'bottom'
		});

	var chartData = svg.append("g");
	chartData.selectAll("g")	//	Bar Groups
		.data(dataset, dataKey)
		.enter()
		.append("g")
		.each(function (dData, iData) {
			var group = d3.select(this);

			group.selectAll("rect")
				.data(sampleSize)
				.enter()
				.append("rect")
				.attr("y", function (d, i) {
					return yScaleOuter(iData) + yScaleInner(i);
				})
				.attr("x", dimensions.dataLeft())
				.attr("height", yScaleInner.rangeBand())
				.attr("width", function (d, i) {
					return xScale(dData.data[i] / d.quantity);
				})
				.attr("data-toggle", "tooltip")
				.attr("title", function (d, i) {
					return dData.data[i] + " out of " + d.quantity + " " +
						d.title.toLowerCase() +
						" companies surveyed experience pain in this area";
				})
				.style({
					// 'stroke': '#203368',
					'stroke-width': 0
				})
				.style("fill", function (d, i) {
					return colors(i);
				})
				.on("mouseover", function() {
					d3.select(this)
						.style("filter", "url(#drop-shadow)");
				})
				.on("mouseout", function(d) {
					d3.select(this)
						.style("filter", "");
				});

			group.selectAll("text")
				.data(sampleSize)
				.enter()
				.append("text")
				.text(function (d, i) {
					return percentFormat(dData.data[i] / d.quantity);
				})
				.attr("x", function (d, i) {
					return dimensions.dataLeft() +
						xScale(dData.data[i] / d.quantity) +
						dimensions.paddingHorizontal;
				})
				.attr("y", function (d,i) {
					return yScaleOuter(iData) + yScaleInner(i) +
						yScaleInner.rangeBand() / 2;
				})
				.style({
					'text-anchor': 'left',
					'font-family': 'Open Sans',
					'fill': '#58585b',
					'alignment-baseline': 'middle'
				})
				.style('font-size', function () {
					return Math.min(
							Math.round(yScaleInner.rangeBand() * 0.8),
							18
						) + "px";
				});
		});

	var calloutBox = svg.append("g");
	if (!dimensions.showCalloutBox) {
		calloutBox.style("display", "none");
	}
	calloutBox.append("rect")
		.attr("x", function () {
			return dimensions.calloutLeft();
		})
		.attr("y", function () {
			return dimensions.calloutTop();
		})
		.attr("width", function () {
			return dimensions.calloutWidth();
		})
		.attr("height", function () {
			return dimensions.calloutHeight();
		})
		.style({
			'fill': 'rgba(88, 88, 91, 0.1)',
			'stroke-width': '0'
		});
	calloutBox.append("text")
		.attr("class", "title")
		.text("Difference between low and high maturity organizations")
		.attr("x", dimensions.calloutCenterHorizontal())
		.attr("y", (dimensions.legendTop() + dimensions.paddingVertical * 3))
		.call(wrapLines, dimensions.calloutWidth() / 1.2)
		.style({
			'fill': '#58585b',
			'font-family': "Open Sans",
			'font-size': '14px',
			'text-anchor': 'middle',
			'alignment-baseline': 'top',
			'font-weight': 700
		})
	calloutBox.selectAll("text.difference")
		.data(dataset, dataKey)
		.enter()
		.append("text")
		.attr("class", "difference")
		.attr("x", dimensions.calloutCenterHorizontal())
		.attr("y", function (d, i) {
			return yScaleOuter(i) + yScaleOuter.rangeBand() / 2;
		})
		.style({
			'fill': '#58585b',
			'font-family': "Roboto Slab",
			'font-size': '24px',
			'text-anchor': 'middle',
			'alignment-baseline': 'center'
		})
		.text(function (d) {
			last = sampleSize.length - 1;
			return percentFormat(Math.abs((d.data[0] / sampleSize[0].quantity) -
				(d.data[last] / sampleSize[last].quantity)));
		});

	// filters go in defs element
	var defs = svg.append("defs");
	var filter = defs.append("filter")
	    .attr("id", "drop-shadow")
	    .attr("height", "130%");
	filter.append("feGaussianBlur")
	    // .attr("in", "SourceAlpha")
	    .attr("stdDeviation", 3)
	    .attr("result", "blur");
	filter.append("feOffset")
	    .attr("in", "blur")
	    .attr("dx", 0)
	    .attr("dy", 0)
	    .attr("result", "offsetBlur");
	var feMerge = filter.append("feMerge");

	feMerge.append("feMergeNode")
	    .attr("in", "offsetBlur")
	feMerge.append("feMergeNode")
	    .attr("in", "SourceGraphic");

	this.changeData = function (newDataset, newSampleSize, newTitleText, newCallout) {
		var oldSampleLength = sampleSize.length;

		dataset = newDataset;
		sampleSize = newSampleSize;
		titleText = newTitleText;
		dimensions.showCalloutBox =
			(typeof newCallout !== 'undefined') ? newCallout : true;

		if (title.selectAll("text").text() !== newTitleText) {
			$(title.selectAll("text")[0][0])
				.animate({'opacity': 0}, { complete: function () {
						title.selectAll("text")
							.text(newTitleText)
							.call(resizeText, dimensions.innerWidth(), 42);
						$(this).animate({'opacity': 1});
					}});
		}

		if (!dimensions.showCalloutBox) {
			calloutBox.style("display", "none");
		} else {
			calloutBox.style("display", "");
		}

		xScale.domain([0, d3.max(dataset, function (d) {
				return d3.max(d.data, function (d, i) {
						return d / sampleSize[i].quantity;
					});
				})
			])
			.range([0, dimensions.dataWidth()]);
		yScaleOuter.domain(d3.range(newDataset.length));
		yScaleInner.domain(d3.range(newSampleSize.length));
		legendSpacing.domain(d3.range(sampleSize.length))
			.rangeRoundBands(
				[dimensions.legendLeft(), dimensions.legendRight()], 0.1);

		chartData.selectAll("g")
			.data(newDataset, dataKey)
			.each(function (dData, iData) {
				var group = d3.select(this);

				group.selectAll("rect")
					.data(newSampleSize)
					.exit()
					.remove();
				group.selectAll("rect")
					.data(newSampleSize)
					.transition()
					.attr("y", function (d, i) {
						return yScaleOuter(iData) + yScaleInner(i);
					})
					.attr("x", dimensions.dataLeft())
					.attr("height", yScaleInner.rangeBand())
					.attr("width", function (d, i) {
						return xScale(dData.data[i] / d.quantity);
					});
				group.selectAll("rect")
					.data(newSampleSize)
					.enter()
					.append("rect")
					.attr("y", function (d, i) {
						return yScaleOuter(iData) + yScaleInner(i);
					})
					.attr("x", dimensions.dataLeft())
					.attr("height", yScaleInner.rangeBand())
					.attr("width", 0)
					.attr("data-toggle", "tooltip")
					.attr("title", function (d, i) {
						return dData.data[i] + " out of " + d.quantity + " " +
							d.title.toLowerCase() +
							" companies surveyed experience pain in this area";
					})
					.style({
						// 'stroke': '#203368',
						'stroke-width': 0
					})
					.style("fill", function (d, i) {
						return colors(i);
					})
					.on("mouseover", function() {
						d3.select(this)
							.style("filter", "url(#drop-shadow)");
					})
					.on("mouseout", function(d) {
						d3.select(this)
							.style("filter", "");
					})
					.transition()
					.attr("width", function (d, i) {
						return xScale(dData.data[i] / d.quantity);
					});

				group.selectAll("text")
					.data(newSampleSize)
					.exit()
					.remove();
				group.selectAll("text")
					.data(newSampleSize)
					.style('font-size', function () {
						return Math.min(
								Math.round(yScaleInner.rangeBand() * 0.8),
								18
							) + "px";
					})
					.text(function (d, i) {
						return percentFormat(dData.data[i] / d.quantity);
					})
					.transition()
					.attr("x", function (d, i) {
						return dimensions.dataLeft() +
							xScale(dData.data[i] / d.quantity) +
							dimensions.paddingHorizontal;
					})
					.attr("y", function (d,i) {
						return yScaleOuter(iData) + yScaleInner(i) +
							yScaleInner.rangeBand() / 2;
					})
				group.selectAll("text")
					.data(newSampleSize)
					.enter()
					.append("text")
					.text(function (d, i) {
						return percentFormat(dData.data[i] / d.quantity);
					})
					.attr("x", function (d, i) {
						return dimensions.dataLeft() +
							xScale(dData.data[i] / d.quantity) +
							dimensions.paddingHorizontal;
					})
					.attr("y", function (d,i) {
						return yScaleOuter(iData) + yScaleInner(i) +
							yScaleInner.rangeBand() / 2;
					})
					.style({
						'text-anchor': 'left',
						'font-family': 'Open Sans',
						'fill': '#58585b',
						'alignment-baseline': 'middle'
					})
					.style('font-size', function () {
						return Math.min(
								Math.round(yScaleInner.rangeBand() * 0.8),
								18
							) + "px";
					});
			});

		yAxisGroup.selectAll("path")	//	Y-axis line
			.attr("d", function () {
				var path = "";
				path += "M" + (dimensions.yAxisRight() - 1) + "," +
					dimensions.dataTop();
				path += "L" + (dimensions.yAxisRight() - 1) + "," +
					dimensions.dataBottom();
				return path;
			});
		yAxisGroup.selectAll("text")
			.call(reWrapLines, 
				(dimensions.yAxisWidth() - dimensions.paddingHorizontal)/1.1)
			.transition()
			.attr("x", function () {
				return dimensions.yAxisRight() - dimensions.paddingHorizontal;
			})
			.selectAll("tspan")
			.attr("x", function () {
				return dimensions.yAxisRight() - dimensions.paddingHorizontal;
			});

		calloutBox.selectAll("rect")
			.attr("x", function () {
				return dimensions.calloutLeft();
			})
			.attr("y", function () {
				return dimensions.calloutTop();
			})
			.attr("width", function () {
				return dimensions.calloutWidth();
			})
			.attr("height", function () {
				return dimensions.calloutHeight();
			});
		calloutBox.selectAll("text.title")
			.attr("x", dimensions.calloutCenterHorizontal())
			.attr("y", 
				(dimensions.legendTop() + dimensions.paddingVertical * 3))
			.call(reWrapLines, dimensions.calloutWidth() / 1.2);
		calloutBox.selectAll("text.difference")
			.attr("x", dimensions.calloutCenterHorizontal())
			.attr("y", function (d, i) {
				return yScaleOuter(i) + yScaleOuter.rangeBand() / 2;
			})
			.data(newDataset, dataKey)
			.text(function (d) {
				var last = newSampleSize.length - 1;
				return percentFormat(Math.abs((d.data[0] /
					newSampleSize[0].quantity) -
					(d.data[last] / newSampleSize[last].quantity)));
			});

		legend.selectAll("text.legend").data(sampleSize).exit().remove();
		legend.selectAll("text.legend").data(sampleSize)
			.text(function (d, i) {
				return  d.title + " (n=" + d.quantity + ")";
			})
			.attr('x', function (d, i) {
				return legendSpacing(i) + 41 * 0.6 +
					dimensions.paddingHorizontal;
			});
		legend.selectAll("text.legend").data(sampleSize).enter()
			.append("text")
			.attr("class", "legend")
			.text(function (d, i) {
				return d.title + " (n=" + d.quantity + ")";
			})
			.attr("x", function (d, i) {
				return legendSpacing(i) + 41 * 0.6 +
					dimensions.paddingHorizontal;
			})
			.attr("y", function () {
				return dimensions.legendCenterVertical();
			})
			.style({
				'fill': '#58585b',
				'font-family': 'Open Sans',
				'font-size': '14px',
				'alignment-baseline': 'middle'
			});

		legend.selectAll("path").data(sampleSize).exit().remove();
		legend.selectAll("path").data(sampleSize)
			.attr('transform', function (d, i) {
				return 'translate(' + (21 * 0.6 + legendSpacing(i)) +
					',' + dimensions.legendCenterVertical() + ') '
					+ 'scale(0.6)';
			});
		legend.selectAll("path").data(sampleSize).enter()
			.append("path")
			.attr("d", hexagonPath)
			.style("fill", function (d, i) {
				return colors(i);
			})
			.style({
				'stroke-width': 0,
				// 'stroke': '#203368'
			})
			.attr('transform', function (d, i) {
				return 'translate(' + (21 * 0.6 + legendSpacing(i)) +
					',' + dimensions.legendCenterVertical() + ') '
					+ 'scale(0.6)';
			});

		$(containerSelector + ' rect')
			.tooltip({
				'trigger': 'hover',
				'container': containerSelector + ' .hovers'
			});
	}

	d3.select(window).on("resize", function () {
		var width = $(containerSelector).width();
		dimensions.width = Math.max(width, dimensions.minWidth);
		svg.attr("width", dimensions.width);

		if (width < dimensions.hideCallout) {
			calloutBox.style({
				'display': 'none'
			});
			dimensions.calloutMinWidth = 0;
			dimensions.calloutProportion = 0;
			dimensions.calloutPaddingLeft = 0;
		} else {
			if (dimensions.showCalloutBox) {
				calloutBox.style({
					'display': ''
				});						
			}

			dimensions.calloutMinWidth = 200;
			dimensions.calloutProportion = 0.2;
			dimensions.calloutPaddingLeft = 50;
		}

		// Adjust the scales
		xScale.range([0, dimensions.dataWidth()]);
		legendSpacing.rangeRoundBands(
			[dimensions.legendLeft(), dimensions.legendRight()], 0.1);

		title.selectAll("text")	//	Title Text
			.attr("y", dimensions.titleBottom())
			.attr("x", dimensions.centerHorizontal())
			.call(resizeText, dimensions.innerWidth(), 42);
		title.selectAll("path")	//	Underline the title
			.attr("d", function () {
				var path = "";
				path += "M" + dimensions.yAxisLeft() + "," + dimensions.titleUnderline();
				path += "L" + dimensions.calloutRight() + "," + dimensions.titleUnderline();
				return path;				
			});	

		legend.selectAll("path")
			.attr('transform', function (d, i) {
				return 'translate(' + (21 * 0.6 + legendSpacing(i)) +
					',' + dimensions.legendCenterVertical() + ')'
					+ 'scale(0.6)';
			});
		legend.selectAll("text.legend")
			.attr("x", function (d, i) {
				return legendSpacing(i) + 41 * 0.6 +
					dimensions.paddingHorizontal;
			})
			.attr("y", dimensions.legendCenterVertical());

		yAxisGroup.selectAll("path")	//	Y-axis line
			.attr("d", function () {
				var path = "";
				path += "M" + (dimensions.yAxisRight() - 1) + "," +
					dimensions.dataTop();
				path += "L" + (dimensions.yAxisRight() - 1) + "," +
					dimensions.dataBottom();
				return path;
			});
		yAxisGroup.selectAll("text")
			.call(reWrapLines, (dimensions.yAxisWidth() - dimensions.paddingHorizontal)/1.1)
			.attr("x", function () {
				return dimensions.yAxisRight() - dimensions.paddingHorizontal;
			})
			.selectAll("tspan")
			.attr("x", function () {
				return dimensions.yAxisRight() - dimensions.paddingHorizontal;
			});

		chartData.selectAll("g")
			.each(function (dData, iData) {
				var group = d3.select(this);

				group.selectAll("rect")
					.attr("x", dimensions.dataLeft())
					.attr("width", function (d, i) {
						return xScale(dData.data[i] / d.quantity);
					});

				group.selectAll("text")
					.attr("x", function (d, i) {
						return dimensions.dataLeft() +
							xScale(dData.data[i] / d.quantity) +
							dimensions.paddingHorizontal;
					});
			});

		calloutBox.selectAll("rect")
			.attr("x", function () {
				return dimensions.calloutLeft();
			})
			.attr("width", function () {
				return dimensions.calloutWidth();
			});

		calloutBox.selectAll("text.title")
			.attr("x", dimensions.calloutCenterHorizontal())
			.call(reWrapLines, dimensions.calloutWidth() / 1.5);

		calloutBox.selectAll("text.difference")
			.attr("x", dimensions.calloutCenterHorizontal());
	});

	d3.select(containerSelector).append("div").attr("class", "hovers");
	$(window).trigger('resize');
	$(containerSelector + ' rect')
		.tooltip({
			'trigger': 'hover',
			'container': containerSelector + ' .hovers'
		});

	return this;
};

		var total = {},
			maturity = {},
			pd = {},
			services = {},
			it = {},
			enterprise = {};

		total.samples = [{quantity: 480, title: "Total Sample", id:"total"}];
		total.title = "Capacity Planning Pain Points";
		total.data = [
			{
				id: "holisticView",
				title: "Lack of a combined, holistic view of both resource capacity and pipeline demand",
				data: [241] 
			},
			{
				id: "whatIf",
				title: "Unable to run what-if scenarios",
				data: [208]
			},
			{
				id: "pipelineDemand",
				title: "Insufficient visibility into pipeline demand",
				data: [194]
			},
			{
				id: "resourceCapacity",
				title: "Insufficient visibility into resource capacity",
				data: [191]
			},			{
				id: "demandPrioritization",
				title: "Ineffective demand prioritization and governance process",
				data: [190]
			}
		];
		total.callout = false;

		pd.samples = [{quantity: 39, title: "Low Maturity", id: 'low'}, {quantity: 45, title: "Medium Maturity", id: 'mid'}, {quantity: 31, title:"High Maturity", id: 'high'}];
		pd.title = "PD Capacity Planning Pain Points";
		pd.data = [
			{
				id: "holisticView",
				title: "Lack of a combined, holistic view of both resource capacity and pipeline demand",
				data: [29,23,5] 
			},
			{
				id: "whatIf",
				title: "Unable to run what-if scenarios",
				data: [21,24,11]
			},
			{
				id: "pipelineDemand",
				title: "Insufficient visibility into pipeline demand",
				data: [25,14,7]
			},
			{
				id: "resourceCapacity",
				title: "Insufficient visibility into resource capacity",
				data: [30,16,2]
			},
			{
				id: "demandPrioritization",
				title: "Ineffective demand prioritization and governance process",
				data: [24,18,5]
			}
		];
		pd.callout = true;

		maturity.samples = [{quantity: 180, title: "Low Maturity", id: 'low'}, {quantity: 152, title: "Medium Maturity", id: 'mid'}, {quantity: 146, title:"High Maturity", id: 'high'}];
		maturity.title = "Capacity Planning Pain Points by Maturity Level";
		maturity.data = [
			{
				id: "holisticView",
				title: "Lack of a combined, holistic view of both resource capacity and pipeline demand",
				data: [130,82,28] 
			},
			{
				id: "whatIf",
				title: "Unable to run what-if scenarios",
				data: [94,73,40]
			},
			{
				id: "pipelineDemand",
				title: "Insufficient visibility into pipeline demand",
				data: [100,59,34]
			},
			{
				id: "resourceCapacity",
				title: "Insufficient visibility into resource capacity",
				data: [124,52,14]
			},
			{
				id: "demandPrioritization",
				title: "Ineffective demand prioritization and governance process",
				data: [103,57,29]
			}
		];
		maturity.callout = true;

		services.samples = [{quantity: 41, title: "Low Maturity", id: 'low'}, {quantity: 39, title: "Medium Maturity", id: 'mid'}, {quantity: 50, title:"High Maturity", id: 'high'}];
		services.title = "Professional Services Capacity Planning Pain Points";
		services.data = [
			{
				id: "holisticView",
				title: "Lack of a combined, holistic view of both resource capacity and pipeline demand",
				data: [27, 20, 12] 
			},
			{
				id: "whatIf",
				title: "Unable to run what-if scenarios",
				data: [16, 15, 11]
			},
			{
				id: "pipelineDemand",
				title: "Insufficient visibility into pipeline demand",
				data: [21, 16, 17]
			},
			{
				id: "resourceCapacity",
				title: "Insufficient visibility into resource capacity",
				data: [20, 11, 4]
			},
			{
				id: "demandPrioritization",
				title: "Ineffective demand prioritization and governance process",
				data: [18, 15, 15]
			}
		];
		services.callout = true;

		it.samples = [{quantity: 48, title: "Low Maturity", id: 'low'}, {quantity: 45, title: "Medium Maturity", id: 'mid'}, {quantity: 25, title:"High Maturity", id: 'high'}];
		it.title = "IT Capacity Planning Pain Points";
		it.data = [
			{
				id: "holisticView",
				title: "Lack of a combined, holistic view of both resource capacity and pipeline demand",
				data: [37, 29, 5] 
			},
			{
				id: "whatIf",
				title: "Unable to run what-if scenarios",
				data: [27, 25, 9]
			},
			{
				id: "pipelineDemand",
				title: "Insufficient visibility into pipeline demand",
				data: [24, 23, 6]
			},
			{
				id: "resourceCapacity",
				title: "Insufficient visibility into resource capacity",
				data: [37, 19, 5]
			},
			{
				id: "demandPrioritization",
				title: "Ineffective demand prioritization and governance process",
				data: [33, 17, 3]
			}
		];
		it.callout = true;

		enterprise.samples = [{quantity: 39, title: "Low Maturity", id: 'low'}, {quantity: 15, title: "Medium Maturity", id: 'mid'}, {quantity: 34, title:"High Maturity", id: 'high'}];
		enterprise.title = "Enterprise Capacity Planning Pain Points";
		enterprise.data = [
			{
				id: "holisticView",
				title: "Lack of a combined, holistic view of both resource capacity and pipeline demand",
				data: [28, 7, 4] 
			},
			{
				id: "whatIf",
				title: "Unable to run what-if scenarios",
				data: [22, 7, 8]
			},
			{
				id: "pipelineDemand",
				title: "Insufficient visibility into pipeline demand",
				data: [22, 4, 2]
			},
			{
				id: "resourceCapacity",
				title: "Insufficient visibility into resource capacity",
				data: [30, 6, 3]
			},
			{
				id: "demandPrioritization",
				title: "Ineffective demand prioritization and governance process",
				data: [24, 4, 5]
			}
		];
		enterprise.callout = true;


		var chart = drawRMCPChart("#bar-chart", total.data, total.samples, total.title, total.callout);

		var setChartData = function (chart, data) {
			chart.changeData(data.data, data.samples, data.title, data.callout);
		}

		d3.selectAll(".total-data")
			.on("click", function () { setChartData(chart, total); });
		d3.selectAll(".maturity-data")
			.on("click", function () { setChartData(chart, maturity); });
		d3.selectAll(".services-data")
			.on("click", function () { setChartData(chart, services); });
		d3.selectAll(".pd-data")
			.on("click", function () { setChartData(chart, pd); });
		d3.selectAll(".it-data")
			.on("click", function () { setChartData(chart, it); });
		d3.selectAll(".enterprise-data")
			.on("click", function () { setChartData(chart, enterprise); });


</script>
</body>
</html>